<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Steem Keychain Handshake Test</title>
</head>
<body>
<h2>Steem Keychain requestHandshake Test</h2>

<button onclick="doHandshake()">Handshake 実行</button>

<div id="log" style="margin-top:15px; font-family:monospace;"></div>

<script>
// ログ表示用
function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
}

// Handshake 実行
function doHandshake() {
    document.getElementById("log").innerHTML = "";
    log("⏳ requestHandshake を送信…");

    // Keychain が存在するか確認
    if (!window.steem_keychain) {
        log("❌ steem_keychain が見つかりません。拡張機能が無効か未インストールです。");
        return;
    }

    // requestHandshake（双方向通信テスト）
    steem_keychain.requestHandshake(function (response) {
        console.log(response); // 開発者ツールにも表示

        if (response === undefined) {
            log("⚠ callback 受信: undefined（拡張機能の古いバージョンの可能性あり）");
            return;
        }

        if (response.success) {
            log("✅ 双方向 handshake 成功");
            log("message: " + response.message);

            if (response.result) {
                log("version: " + response.result.steem_keychain_version);
                log("installed: " + response.result.installed);
            }
        } else {
            log("❌ 失敗: " + response.message);
        }
    });
}
</script>

</body>
</html>
