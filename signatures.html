<html>
<head>
<meta charset="UTF-8">
<title>Steem Keychain Signed Transaction Test</title>
</head>
<body>

<h3>Steem Keychain requestSignedTransaction テスト</h3>

<textarea id="tx" rows="15" cols="50">
{
  "ref_block_num": 4935,
  "ref_block_prefix": 1192429318,
  "expiration": "2025-11-30T12:00:00",
  "operations": [
    [
      "transfer",
      {
        "from": "youraccount",
        "to": "destination",
        "amount": "0.001 STEEM",
        "memo": "test memo"
      }
    ]
  ],
  "extensions": []
}
</textarea>

<br><br>
<button onclick="signTx()">requestSignedTransaction で署名する</button>

<br><br>
<textarea id="result" rows="15" cols="50" readonly></textarea>

<script>
async function signTx() {
    const resultEl = document.getElementById("result");

    if (!window.steem_keychain) {
        resultEl.value = "❌ Steem Keychain が見つかりません。ブラウザ拡張を有効にしてください。";
        return;
    }

    let tx;
    try {
        tx = JSON.parse(document.getElementById("tx").value);
    } catch (e) {
        resultEl.value = "❌ JSON パースエラー: " + e.message;
        return;
    }

    // 操作者（from アカウント）を取得
    const username = tx.operations[0][1].from;

    steem_keychain.requestSignedTransaction(
        username,
        tx,
        "active",
        function (res) {
            if (!res.success) {
                resultEl.value = "❌ 署名失敗\n" + JSON.stringify(res, null, 2);
                return;
            }

            // res.result は "signed transaction"（完全な署名トランザクション）
            resultEl.value = "✔ 署名成功\n\n" + JSON.stringify(res.result, null, 2);
        }
    );
}
</script>

</body>
</html>
